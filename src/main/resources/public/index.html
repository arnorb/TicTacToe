<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>TicTacToe</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet/less" href="styles.less">
    <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/1.4.1/less.min.js" type="text/javascript"></script>
    <!-- load bootstrap for nicer ui -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">
  </head>
  <body lang="is">

    <div class="container">
      <h1>Spilaðu Tic Tac Toe!</h1>
      <div>
      <h3>Stig </h3>
      <ul class="nav nav-pills">
      <li>X: <span class="badge" id="score1"></span></li>
      <li>O: <span class="badge" id="score2"></span></li>
      </ul>
      </div>
      <p id="next_player"></p>
      
        

          <div class="game-board clearfix center-block">
          
                <div class="parent-row0">
                  <span class="board-field row0 column0" data-value="0">&nbsp;</span>
                  <span class="board-field row0 column1" data-value="1">&nbsp;</span>
                  <span class="board-field row0 column2" data-value="2">&nbsp;</span>
                </div>
          
                <div class="parent-row1">
                  <span class="board-field row1 column0" data-value="3">&nbsp;</span>
                  <span class="board-field row1 column1" data-value="4">&nbsp;</span>
                  <span class="board-field row1 column2" data-value="5">&nbsp;</span>
                </div>
          
                <div class="parent-row2">
                  <span class="board-field row2 column0" data-value="6">&nbsp;</span>
                  <span class="board-field row2 column1" data-value="7">&nbsp;</span>
                  <span class="board-field row2 column2" data-value="8">&nbsp;</span>
                </div>
          
          </div>

      <hr>
      <div id="results">
      </div>

      <div >
        <button id="new_game" type="button" class="btn btn-default" >Spila aftur</button>
      </div>
    </div>

    <!-- load jquery -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

    <!-- use ajax to submit form, retreive the result and display on the page -->
    <!-- use ajax to submit form, retreive the result and display on the page -->
       <script>
       $(document).ready(function() {

         reset();

       });

       function fill(){
        $( ".board-field" ).addClass('not-allowed').removeClass('board-field').off('click'); 
        $("#new_game").css('display','block');
      }


       function new_game(){

        var player = 1;
        $("#next_player").html('Spilari X gerir fyrst'); 
        $("#results").removeClass('alert alert-success').html(''); 
        $("#new_game").css('display','none');
        $( ".not-allowed" ).html('&nbsp;').addClass('board-field').removeClass('not-allowed').on('click'); 

        $( ".board-field" ).click(function() {



           var x, y, tPl = player, selectedField = $(this);



           if (selectedField.text() != '×' && selectedField.text() != 'o' ) {
             if(player == 1){
               x = '×';
               y = 'O';
               player = 2;
             }
             else
             {
               x = 'o';
               y = 'X';
               player = 1;
             }

            $("#next_player").html('Spilari ' + y + ' gerir næst');
            
           }

           //$( this ).attr(value, player)
           selectedField.text(x);
           selectedField.addClass('not-allowed').removeClass('board-field').off('click');

           send($( this ).attr('data-value'), tPl); 
         });


          $( "#new_game" ).click(function() {
          new_game();
          });

                $.ajax({
                   type: 'get',
                   url: '/new',
                   data: ''
                 }).done(function(win) {
                 }).fail(function() {
                   $('#results').html('Villa kom upp').attr('class', 'alert alert-danger');
                 });


        }

         function send(i, p){

                 var val = i;

                 $.ajax({
                   type: 'post',
                   url: '/add',
                   data: 'val=' + val
                 }).done(function(win) {
                   if (win != ""){
                   $('#results').html(win).attr('class', 'alert alert-success');
                    score(p);
                    $("#next_player").html('Leik lokið');
                    fill();}
                 }).fail(function() {
                   $('#results').html('Villa kom upp').attr('class', 'alert alert-danger');
                 });

         }

         function score(p) {
            $.ajax({
                   type: 'post',
                   url: '/score',
                   data: 'val=' + p
                 }).done(function(result) { 
                      $( "#score" + p ).html(result);
                  });
               }
          function reset() {
            $.ajax({
              type: 'post',
              url: '/reset',
              data: ''
            }).done(function() {
              new_game();
              $("#score1").html('0');
              $("#score2").html('0');
            });
          }

          

       </script>
  </body>
</html>